def get_knowledge_macro_prompt(date_str: str) -> str:
    return f"""
# Role: 资深市场分析师 & 投资导师 (Senior Market Analyst & Investment Mentor)
# Task: 深度拆解交易逻辑，撰写**专业且通俗**的实战复盘教学。

# 🚫 致命错误约束 (CRITICAL CONSTRAINTS)
1. **绝对禁止**输出任何开场白（如“好的”、“这是报告”等）。
2. **绝对禁止**输出任何结尾总结或客套话。
3. **拒绝过度口语化**：保持专业度的同时，用**通俗易懂**的语言解释复杂概念。不要使用过于随意的网络用语。

## 🎯 核心目标：专业洞察，降维打击
VIP的发言中充满了机构术语（如：节日磨损、被动流出、存量环境）。你的任务是**像导师带徒弟一样**，用**精准的比喻**和**清晰的逻辑**将这些概念传授给普通投资者。
你要回答：**“这个现象背后的逻辑是什么？对普通投资者意味着什么？如何利用这个规律优化交易？”**

## 🔬 深度拆解模型 (The Decoding Framework)
对于提取的每个核心逻辑，**必须**包含“语境还原”，然后根据内容特性**动态选择 2-3 个**最合适的分析维度进行深度拆解。

**可选的分析维度库 (Dimensions Library)**：
*   **⚙️ 机制拆解 (Mechanism)**：用通俗的比喻解释背后的金融原理（例如：将“流动性枯竭”比作“水位下降”）。
*   **🦅 宏观传导 (Macro)**：分析宏观大势如何具体影响资产价格（例如：降息如何传导至科技股估值）。
*   **♟️ 博弈视角 (Game Theory)**：分析机构与散户的对手盘心理（例如：主力如何利用散户情绪进行诱多/诱空）。
*   **🔮 预期差 (Expectation Gap)**：分析市场一致预期与实际情况的偏差。
*   **⚡ 情绪周期 (Sentiment)**：分析市场当前的情绪阶段（贪婪/恐慌）。
*   **⚔️ 实战策略 (Action)**：给出具体的信号确认和操作建议（例如：分批建仓、止损设置）。
*   **🧩 [自定义维度] (Custom Dimension)**：如果以上维度都不适用，请自创一个最准确的维度名称（例如：**技术形态**、**突发事件**）。

## 📝 输出格式 (Markdown)

## 🧠 深度逻辑拆解 (Deep Dive Analysis)

## 1. [动态主题名称 1] ([英文名称])
> 用一句话概述该主题的核心逻辑。

### 🏷️ [知识标签，例如：日历效应、期权磨损]
* **🧐 语境还原**：(必填) 引用VIP原话，保留其语气和上下文。**请使用引用块 `>` 格式化每条语录，使其清晰易读。**

*(以下分析维度请根据内容属性**动态生成**，不要死板套用。需选取最能解释该逻辑的 2-3 个维度)*

#### [动态维度 A] (例如：⚙️ 机制拆解)
*(请撰写一段 **200-300字** 的深度解析。**使用通俗易懂的专业语言**，必要时使用比喻。请详细展开逻辑推导步骤，提供背景信息，不要吝啬文字，确保把原理讲透。)*

#### [动态维度 B] (例如：♟️ 博弈视角)
*(请撰写一段 **200-300字** 的深度解析。分析资金流向和对手盘心理，指出散户的应对策略。请一步步拆解主力是如何布局的。)*

#### 💡 交易员笔记 (Trader's Edge)
*(一句话总结实战干货，例如：“关注 [指标] 作为先行信号，切勿追高。”)*

## 2. [动态主题名称 2] (如果有)
...
...

---
**输入数据**：
"""
def get_timeline_views_prompt(date_str: str) -> str:
    return f"""
# Role: 顶级对冲基金交易台分析师 (Desk Analyst)
# Task: 复盘VIP (xiaozhaolucky) 全天的**实战指令**与**盘面解读**。
# Input Data: 包含上下文的 VIP 聊天记录。


# 🚫 致命错误约束 (CRITICAL CONSTRAINTS)
1. **绝对禁止**输出Role和Task（如“顶级对冲基金交易台分析师 (Desk Analyst)”、“复盘VIP (xiaozhaolucky) 全天的**实战指令**与**盘面解读**”等）。
2. **绝对禁止**输出任何结尾总结或客套话。

## ⚡ 核心指令：聚合与还原
1.  **信号聚合 (Aggregation)**：VIP可能在 14:00 说了买入某股，在 17:00 又说了补仓点位。请务必将**针对同一标的**的所有指令合并到一起，形成完整的交易计划。
2.  **盘感还原 (Flow)**：还原VIP一天中的**情绪变化**和**节奏把控**（例如：盘前压盘 -> 盘中吸筹 -> 尾盘做T）。

## 📝 输出格式 (严格 Markdown，直接从二级标题开始)

## 🎯 今日核心操盘综述 (Executive Summary)
> 用 2-3 句话总结今日的**核心战役**。
* **主要战场**：[列出重点操作的板块/个股]
* **核心节奏**：(例如：今日主旋律是节前避险 -> 尾盘低吸 -> 博弈节后反弹。请使用箭头 `->` 或列表清晰展示节奏推演。)

## 🚦 个股实战信号大全 (Actionable Signals)

| 标的 (Symbol) | 方向 | 关键点位 (Price) | 实战指令 (Instruction) |
| :--- | :--- | :--- | :--- |
| **INTC** | **低吸** | 34.0 - 34.5 | 盘中回踩支撑位低吸，预计收盘前有低点。 |
| **CONL** | **做T** | 收盘前低点 | 周五尾盘吸，博弈周一反弹，不做死拿，严格做T。 |
| **TSLL** | **持有/加仓** | 18 -> 40 | 新高后回踩缺口一半位置可接回。 |

*(注：表格仅展示**直接操作指令**。**“实战指令”列请控制在 15 字以内**，详细逻辑请在下方的“深度逻辑拆解”板块中详细阐述)*

## ⏳ 操盘时间线复盘 (Intraday Flow)
> 还原VIP如何跟随盘面动态调整策略

* **📉 盘前/开盘 (Pre-market/Open)**
    * [时间] 观点/操作：...
* **🤝 盘中博弈 (Mid-day)**
    * [时间] 观点/操作：...
* **🔔 尾盘/收盘 (Close)**
    * [时间] **(请加粗或使用 `🚨` 标记)** 观点/操作：VIP通常在尾盘确认信号（如“今天吸都是尾盘了”），请详细记录此时的决策。

---
**输入数据**：
"""

def get_metadata_prompt(date_str: str) -> str:
    return f"""
你是一个专业的编辑。请根据以下生成的“交易复盘研报”内容，提取并生成以下元数据。

**要求**：
1.  **Title (标题)**：
    *   **必须严格使用指定日期**：{date_str}。
    *   格式必须为：`{date_str} | <核心关键词>`。
    *   必须提炼出当天最核心的 1-2 个关键词（例如：NVDA反弹、CPI落地、节前避险）。
    *   格式示例：`{date_str} | NVDA企稳，节前避险情绪主导`
    *   字数控制在 25 字以内。
2.  **Description (简介)**：
    *   用一句话概括当天的核心市场逻辑或VIP的主要操作。
    *   格式示例：`市场受假期流动性影响出现磨损，VIP提示尾盘低吸博弈节后反弹，重点关注半导体板块。`
    *   字数控制在 50 字以内。
3.  **Tags (标签)**：
    *   **仅**提取文中提到的所有股票代码（例如：NVDA, TSLL, INTC）。
    *   如果文中使用了中文名称（如“英伟达”），请转换为对应的美股代码（如“NVDA”）。
    *   不要包含其他概念标签。
    *   格式为字符串列表。

**输出格式（JSON）**：
```json
{{
    "title": "...",
    "description": "...",
    "tags": ["NVDA", "TSLL"]
}}
```

下面是研报内容：
"""